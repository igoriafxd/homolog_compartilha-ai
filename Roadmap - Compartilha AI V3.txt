# ğŸ—ºï¸ Roadmap - Compartilha AI V3

## ğŸ“Š Stack Atual
- **Backend**: Render (Free)
- **Frontend**: Vercel (Free)
- **AI**: Google Gemini (Free)
- **Banco**: A implementar - Supabase (Free)

---

## ğŸ”’ FASE 0: SeguranÃ§a da API (CRÃTICO - FAZER PRIMEIRO!)

### Por que isso Ã© prioridade mÃ¡xima?
Sua API estÃ¡ **totalmente aberta** agora. Qualquer pessoa que descubra sua URL pode:
- âŒ Fazer requisiÃ§Ãµes ilimitadas e esgotar seu free tier
- âŒ Gastar toda sua quota do Gemini
- âŒ Sobrecarregar seu servidor no Render
- âŒ Enviar dados maliciosos
- âŒ Usar sua API em projetos de terceiros

### SoluÃ§Ã£o: Implementar AutenticaÃ§Ã£o por Token

#### OpÃ§Ã£o A: Token Simples (RECOMENDADO para comeÃ§ar)
**Melhor para**: Proteger rapidamente, sem complicaÃ§Ãµes

```python
# backend/main.py
from fastapi import Header, HTTPException
import secrets

# Gere um token Ãºnico (faÃ§a isso UMA VEZ e guarde)
# No terminal Python: secrets.token_urlsafe(32)
API_SECRET_TOKEN = "seu_token_super_secreto_aqui_123abc"

async def verify_token(x_api_key: str = Header(...)):
    if x_api_key != API_SECRET_TOKEN:
        raise HTTPException(status_code=403, detail="Token invÃ¡lido")
    return x_api_key

# Use em TODOS os endpoints:
@app.post("/api/scan", dependencies=[Depends(verify_token)])
async def scan_receipt(file: UploadFile):
    # seu cÃ³digo aqui
```

**No Frontend (api.js):**
```javascript
// frontend/src/services/api.js
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL,
  headers: {
    'X-API-Key': import.meta.env.VITE_API_SECRET_TOKEN
  }
});

export default api;
```

**Arquivo .env no Frontend:**
```env
VITE_API_URL=https://sua-api.render.com
VITE_API_SECRET_TOKEN=seu_token_super_secreto_aqui_123abc
```

**Arquivo .env no Backend:**
```env
API_SECRET_TOKEN=seu_token_super_secreto_aqui_123abc
GEMINI_API_KEY=sua_chave_gemini
```

#### OpÃ§Ã£o B: JWT (JSON Web Tokens)
**Melhor para**: Quando adicionar login de usuÃ¡rios depois

Por enquanto, **nÃ£o precisa**. JWT Ã© mais complexo e faz mais sentido quando vocÃª tiver sistema de usuÃ¡rios.

---

### âœ… Checklist - SeguranÃ§a Imediata (FASE 0):

**Backend:**
- [ ] Gerar token secreto Ãºnico com `secrets.token_urlsafe(32)`
- [ ] Criar funÃ§Ã£o `verify_token` no main.py
- [ ] Adicionar `dependencies=[Depends(verify_token)]` em TODOS os endpoints
- [ ] Criar arquivo `.env` no backend com o token
- [ ] Adicionar `.env` no `.gitignore` (NUNCA commitar tokens!)
- [ ] Configurar variÃ¡vel de ambiente no Render com o token
- [ ] Testar endpoints com e sem token (deve bloquear sem token)

**Frontend:**
- [ ] Criar arquivo `.env` na raiz do frontend
- [ ] Adicionar token no .env
- [ ] Adicionar `.env` no `.gitignore`
- [ ] Modificar `api.js` para incluir o header `X-API-Key`
- [ ] Configurar variÃ¡vel de ambiente no Vercel com o token
- [ ] Testar se requisiÃ§Ãµes funcionam corretamente

**ProteÃ§Ãµes Adicionais:**
- [ ] Instalar `pip install python-multipart slowapi`
- [ ] Adicionar rate limiting (mÃ¡ximo de requisiÃ§Ãµes por IP):

```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

@app.post("/api/scan")
@limiter.limit("5/minute")  # MÃ¡ximo 5 uploads por minuto por IP
async def scan_receipt(request: Request, file: UploadFile):
    # seu cÃ³digo
```

- [ ] Adicionar validaÃ§Ã£o de tamanho de arquivo:
```python
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB

@app.post("/api/scan")
async def scan_receipt(file: UploadFile):
    contents = await file.read()
    if len(contents) > MAX_FILE_SIZE:
        raise HTTPException(400, "Arquivo muito grande (mÃ¡x 10MB)")
    # processar arquivo...
```

- [ ] Adicionar validaÃ§Ã£o de tipo de arquivo:
```python
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'webp'}

@app.post("/api/scan")
async def scan_receipt(file: UploadFile):
    ext = file.filename.split('.')[-1].lower()
    if ext not in ALLOWED_EXTENSIONS:
        raise HTTPException(400, "Tipo de arquivo nÃ£o permitido")
```

- [ ] Configurar CORS corretamente (apenas seu domÃ­nio):
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://seu-app.vercel.app",  # ProduÃ§Ã£o
        "http://localhost:5173"  # Desenvolvimento
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

- [ ] Instalar e configurar helmet:
```python
pip install fastapi-security

from fastapi_security import SecurityHeaders

app.add_middleware(SecurityHeaders)
```

---

### ğŸš¨ AVISOS IMPORTANTES:

1. **NUNCA commite tokens no Git!**
   - Sempre use `.env` files
   - Sempre adicione `.env` no `.gitignore`
   - Configure tokens como variÃ¡veis de ambiente no Render/Vercel

2. **Rotacione tokens se expor acidentalmente**
   - Se vocÃª commitou um token por engano, MUDE ele imediatamente
   - Gere um novo token e atualize em todos os lugares

3. **Free tier do Render hiberna apÃ³s 15min**
   - Primeira requisiÃ§Ã£o apÃ³s hibernar demora ~1min para acordar
   - Considere um cron job para manter acordado (ou aceite o delay)

---

## ğŸ¯ FASE 1: FundaÃ§Ã£o & Banco de Dados (Prioridade ALTA)

### 1.1 Estrutura de Banco de Dados (Supabase)
**Objetivo**: Persistir dados e permitir histÃ³rico de divisÃµes

#### Tabelas NecessÃ¡rias:

**`users`** (se implementar login)
```sql
- id (uuid, primary key)
- email (text, unique)
- password_hash (text)
- name (text)
- created_at (timestamp)
- last_login (timestamp)
```

**`divisoes`** (sessÃµes de divisÃ£o)
```sql
- id (uuid, primary key)
- user_id (uuid, foreign key) - nullable se nÃ£o tiver login
- session_id (text, unique) - para divisÃµes anÃ´nimas
- subtotal (decimal)
- desconto (decimal)
- taxa_percentual (decimal)
- total (decimal)
- status (enum: 'em_progresso', 'finalizada')
- created_at (timestamp)
- updated_at (timestamp)
```

**`itens`**
```sql
- id (uuid, primary key)
- divisao_id (uuid, foreign key)
- nome (text)
- quantidade (integer)
- valor_unitario (decimal)
- valor_total (decimal)
- distribuido (boolean)
- ordem (integer)
- created_at (timestamp)
```

**`pessoas`**
```sql
- id (uuid, primary key)
- divisao_id (uuid, foreign key)
- nome (text)
- avatar_cor (text) - hex color
- created_at (timestamp)
```

**`item_pessoa`** (tabela de relacionamento muitos-para-muitos)
```sql
- id (uuid, primary key)
- item_id (uuid, foreign key)
- pessoa_id (uuid, foreign key)
- quantidade (decimal) - para divisÃµes fracionadas (1/3, etc)
- valor_atribuido (decimal)
- created_at (timestamp)
```

**`historico_divisoes`** (para guardar finalizadas)
```sql
- id (uuid, primary key)
- divisao_id (uuid, foreign key)
- snapshot_json (jsonb) - snapshot completo da divisÃ£o
- compartilhado (boolean)
- created_at (timestamp)
```

#### âœ… Checklist - Banco de Dados:
- [ ] Criar conta no Supabase
- [ ] Configurar projeto no Supabase
- [ ] Criar todas as tabelas com migrations
- [ ] Configurar Row Level Security (RLS) policies
- [ ] Testar CRUD bÃ¡sico de cada tabela
- [ ] Documentar estrutura do banco

---

### 1.2 AutenticaÃ§Ã£o & SeguranÃ§a
**Objetivo**: Proteger API e dados dos usuÃ¡rios

#### OpÃ§Ãµes de AutenticaÃ§Ã£o:

**OpÃ§Ã£o A: Login Completo (Recomendado)**
- Usar Supabase Auth (jÃ¡ vem pronto!)
- Email + senha
- Magic link (email sem senha)
- OAuth (Google, GitHub opcional)

**OpÃ§Ã£o B: SessÃ£o AnÃ´nima (Mais Simples)**
- Gerar session_id Ãºnico por dispositivo
- Guardar no localStorage
- NÃ£o precisa de login/senha
- Dados ficam vinculados ao dispositivo

**Minha RecomendaÃ§Ã£o**: ComeÃ§ar com **OpÃ§Ã£o B** (sessÃ£o anÃ´nima) e depois adicionar **OpÃ§Ã£o A** como feature premium/opcional.

#### âœ… Checklist - SeguranÃ§a Backend:
- [ ] Implementar rate limiting (express-rate-limit)
- [ ] Adicionar validaÃ§Ã£o de dados (zod ou joi)
- [ ] Configurar CORS corretamente
- [ ] Adicionar helmet para headers de seguranÃ§a
- [ ] Criar middleware de autenticaÃ§Ã£o
- [ ] Implementar tokens JWT ou usar Supabase Auth
- [ ] VariÃ¡veis de ambiente para chaves sensÃ­veis
- [ ] Logs de auditoria (quem fez o quÃª)

#### âœ… Checklist - SeguranÃ§a Frontend:
- [ ] SanitizaÃ§Ã£o de inputs do usuÃ¡rio
- [ ] ValidaÃ§Ã£o client-side antes de enviar
- [ ] NÃ£o expor chaves de API no cÃ³digo
- [ ] Implementar session management
- [ ] HTTPS obrigatÃ³rio (Vercel jÃ¡ faz)

---

## ğŸ¨ FASE 2: UX & Novas Features (Prioridade MÃ‰DIA)

### 2.1 PÃ¡gina de Landing/IntroduÃ§Ã£o
**Objetivo**: Explicar o app e converter visitantes

#### ConteÃºdo da Landing:
- Hero section com tÃ­tulo impactante
- Demo visual (GIF ou vÃ­deo curto)
- BenefÃ­cios principais (3-4 cards)
- Como funciona (3-4 passos)
- BotÃ£o CTA: "ComeÃ§ar Agora" (sem cadastro)
- BotÃ£o secundÃ¡rio: "Ver Demo"
- Footer com links Ãºteis

#### PWA - Instalar no Celular:
- Criar `manifest.json`
- Adicionar service worker
- Ãcones em mÃºltiplos tamanhos
- Splash screen personalizada
- Prompt de instalaÃ§Ã£o customizado

#### âœ… Checklist - Landing Page:
- [ ] Design da landing no Figma/Sketch
- [ ] Desenvolver landing page
- [ ] Adicionar animaÃ§Ãµes (framer-motion)
- [ ] Criar manifest.json para PWA
- [ ] Implementar service worker
- [ ] Gerar Ã­cones PWA (512x512, 192x192, etc)
- [ ] Testar instalaÃ§Ã£o em Android
- [ ] Testar instalaÃ§Ã£o em iOS
- [ ] Analytics (Google Analytics ou Plausible)
- [ ] SEO bÃ¡sico (meta tags, Open Graph)

---

### 2.2 GamificaÃ§Ã£o - Roleta Russa ğŸ²
**Objetivo**: Tornar divisÃ£o de contas mais divertida

#### Modos de Jogo:

**1. Roleta AleatÃ³ria Completa**
- Distribui TODOS os itens aleatoriamente
- AnimaÃ§Ã£o de roleta girando
- Revelar resultado dramaticamente

**2. Salvar AlguÃ©m**
- Escolhe 1 pessoa para nÃ£o pagar nada
- Divide o valor dela entre os outros
- AnimaÃ§Ã£o de "sorte grande"

**3. Quem Paga Tudo?**
- Roleta escolhe 1 azarado
- Essa pessoa paga a conta inteira
- Modal de "F no chat" ğŸ˜…

**4. Desafio 50/50**
- Sorteia 2 grupos
- Um grupo paga 75%, outro 25%

**5. Modo Surpresa**
- Cada pessoa roda individualmente
- Pode ganhar desconto (0-50%)
- Ou pagar mais (atÃ© +30%)

#### âœ… Checklist - GamificaÃ§Ã£o:
- [ ] Desenhar fluxo de cada modo
- [ ] Criar componente de Roleta animada
- [ ] Implementar lÃ³gica de distribuiÃ§Ã£o aleatÃ³ria
- [ ] Adicionar sons/efeitos (opcional)
- [ ] Criar modal de resultado dramÃ¡tico
- [ ] Permitir "refazer" sorteio
- [ ] Salvar histÃ³rico de sorteios
- [ ] Compartilhar resultado nas redes

---

### 2.3 Melhorias de UX

#### âœ… Checklist - UX:
- [ ] Adicionar tutorial interativo (first-time user)
- [ ] Implementar undo/redo
- [ ] Dark mode / Light mode toggle
- [ ] AnimaÃ§Ãµes de transiÃ§Ã£o suaves
- [ ] Loading states em todas aÃ§Ãµes
- [ ] Mensagens de erro amigÃ¡veis
- [ ] Toasts para feedback de aÃ§Ãµes
- [ ] Skeleton loaders
- [ ] Drag and drop para reordenar itens
- [ ] Atalhos de teclado (opcional)

---

## ğŸ’¾ FASE 3: PersistÃªncia & HistÃ³rico (Prioridade MÃ‰DIA)

### 3.1 Salvamento AutomÃ¡tico
- [ ] Auto-save a cada mudanÃ§a (debounced)
- [ ] Indicador visual de "salvando..."
- [ ] SincronizaÃ§Ã£o em tempo real (opcional)

### 3.2 HistÃ³rico de DivisÃµes
- [ ] PÃ¡gina de histÃ³rico
- [ ] Lista de divisÃµes anteriores
- [ ] Buscar por data, pessoas, valor
- [ ] Visualizar detalhes de divisÃ£o antiga
- [ ] Duplicar divisÃ£o anterior
- [ ] Excluir divisÃµes antigas
- [ ] Exportar para PDF

### 3.3 Templates/Favoritos
- [ ] Salvar combinaÃ§Ãµes de pessoas frequentes
- [ ] Templates de grupos (ex: "Galera do Trabalho")
- [ ] Itens favoritos recorrentes

---

## ğŸš€ FASE 4: Recursos AvanÃ§ados (Prioridade BAIXA)

### 4.1 Compartilhamento & ColaboraÃ§Ã£o
- [ ] Gerar link compartilhÃ¡vel
- [ ] QR Code da divisÃ£o
- [ ] Modo colaborativo (mÃºltiplas pessoas editando)
- [ ] WhatsApp share com resumo formatado
- [ ] Copiar resumo para clipboard

### 4.2 IntegraÃ§Ãµes
- [ ] IntegraÃ§Ã£o com Pix (copiar/colar chaves)
- [ ] Gerar QR Code Pix por pessoa
- [ ] Export para Splitwise
- [ ] Importar de foto de NFe (se tiver API)

### 4.3 EstatÃ­sticas
- [ ] Dashboard de gastos mensais
- [ ] Com quem vocÃª divide mais
- [ ] MÃ©dia de gasto por pessoa
- [ ] GrÃ¡ficos de distribuiÃ§Ã£o
- [ ] CategorizaÃ§Ã£o de gastos

---

## ğŸ¯ FASE 5: OtimizaÃ§Ã£o & Escala (Prioridade BAIXA)

### 5.1 Performance
- [ ] Code splitting
- [ ] Lazy loading de componentes
- [ ] Otimizar bundle size
- [ ] Cache de imagens
- [ ] CompressÃ£o de assets
- [ ] Lighthouse score > 90

### 5.2 Monitoramento
- [ ] Sentry para error tracking
- [ ] Analytics de uso
- [ ] Logs estruturados
- [ ] Alertas de downtime
- [ ] Dashboard de mÃ©tricas

### 5.3 Testes
- [ ] Testes unitÃ¡rios (principais funÃ§Ãµes)
- [ ] Testes de integraÃ§Ã£o (API)
- [ ] Testes E2E (Playwright/Cypress)
- [ ] CI/CD pipeline

---

## ğŸ“± FASE 6: Mobile First (Prioridade BAIXA)

### 6.1 App Nativo (Opcional)
**OpÃ§Ã£o A**: React Native / Expo
**OpÃ§Ã£o B**: Capacitor (reutiliza cÃ³digo web)

- [ ] Avaliar necessidade de app nativo
- [ ] Converter para React Native (se necessÃ¡rio)
- [ ] Push notifications
- [ ] Publicar na Google Play
- [ ] Publicar na App Store (requer conta developer $99/ano)

---

## ğŸ¨ PrÃ³ximos Passos Recomendados (Ordem Sugerida)

### Sprint 1 (2-3 semanas):
1. âœ… Configurar Supabase
2. âœ… Criar estrutura de tabelas
3. âœ… Implementar sessÃ£o anÃ´nima (session_id)
4. âœ… Migrar lÃ³gica para salvar no banco
5. âœ… Testar CRUD completo

### Sprint 2 (2 semanas):
1. âœ… Implementar seguranÃ§a bÃ¡sica (rate limit, validaÃ§Ã£o)
2. âœ… Criar sistema de histÃ³rico
3. âœ… Melhorar tratamento de erros

### Sprint 3 (2-3 semanas):
1. âœ… Desenvolver landing page
2. âœ… Implementar PWA (manifest + service worker)
3. âœ… Testar instalaÃ§Ã£o mobile

### Sprint 4 (2 semanas):
1. âœ… Implementar primeiro modo de gamificaÃ§Ã£o (Roleta AleatÃ³ria)
2. âœ… Adicionar animaÃ§Ãµes de roleta
3. âœ… Testar e refinar UX

### Sprint 5+ (Melhorias contÃ­nuas):
- Adicionar mais modos de gamificaÃ§Ã£o
- Melhorar analytics
- Features avanÃ§adas conforme feedback

---

## ğŸ’¡ Dicas Importantes

### Mantenha o Free Tier:
- **Render**: 750h/mÃªs grÃ¡tis, mas dorme apÃ³s 15min inatividade
- **Vercel**: 100GB bandwidth/mÃªs grÃ¡tis
- **Supabase**: 500MB database, 2GB bandwidth/mÃªs grÃ¡tis
- **Gemini**: 15 req/min grÃ¡tis (API key individual)

### Quando Considerar Pagar:
- Mais de 1000 usuÃ¡rios ativos/mÃªs
- Backend muito lento (wake-up delays)
- Precisa de mais storage no Supabase

### Alternativas Gratuitas:
- **Backend**: Railway, Fly.io (free tier)
- **Banco**: PlanetScale, Neon (Postgres grÃ¡tis)
- **Analytics**: Plausible (auto-hospedado), Umami

---

## ğŸ“ Notas Finais

**Sobre Login/Senha:**
- Comece SEM login obrigatÃ³rio (melhor UX)
- Use session_id para persistir dados
- Adicione login OPCIONAL depois para:
  - Sincronizar entre dispositivos
  - Acessar histÃ³rico de qualquer lugar
  - Backup na nuvem

**Sobre GamificaÃ§Ã£o:**
- Ã‰ um diferencial MUITO forte! ğŸ²
- Poucos apps de divisÃ£o tÃªm isso
- Foco em diversÃ£o + funcionalidade
- Pode viralizar no TikTok/Instagram

**Priorize:**
1. Funcionalidade core funcionando 100%
2. Salvar no banco (persistÃªncia)
3. Landing page + PWA (aquisiÃ§Ã£o)
4. GamificaÃ§Ã£o (diferencial)
5. HistÃ³rico e features avanÃ§adas

---

## ğŸ¯ Meta de 3 Meses

- âœ… App completo funcionando
- âœ… PWA instalÃ¡vel
- âœ… Banco de dados persistindo tudo
- âœ… 3+ modos de gamificaÃ§Ã£o
- âœ… Landing page profissional
- ğŸ¯ 100+ usuÃ¡rios ativos testando
- ğŸ¯ Feedback e iteraÃ§Ãµes

---

**Bora fazer esse app bombar! ğŸš€**